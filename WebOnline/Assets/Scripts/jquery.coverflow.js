;(function($,undefined){"use strict";var sign=function(number){return number<0?-1:1;},scl=function(number,fromMin,fromMax,toMin,toMax){return((number-fromMin)*(toMax-toMin)/(fromMax-fromMin))+toMin;};$.widget("vanderlee.coverflow",{options:{animateComplete:undefined,animateStep:undefined,density:1,duration:'normal',easing:undefined,index:0,innerAngle:-75,innerCss:undefined,innerOffset:100/3,innerScale:0.75,outerAngle:-30,outerCss:undefined,outerScale:0.25,selectedCss:undefined,visible:'density',width:undefined,change:undefined,confirm:undefined,select:undefined},_create:function(){var that=this;that.widgetEventPrefix='vanderlee-coverflow';that.hovering=false;that.pagesize=1;that.currentIndex=that.options.index;that.element.height(that._getCovers().first().height());that._getCovers().hide().css('position','absolute');that.element.on('click','> *',function(){var index=that._getCovers().index(this);if(index===that.currentIndex){that._callback('confirm');}else{that._setIndex(index,true);}});$(window).resize(function(){that.refresh();});that.element.on('mousewheel',function(event,delta){event.preventDefault();that._setIndex(that.options.index-delta,true);});if($.isFunction(that.element.swipe)){that.element.swipe({swipe:function(event,direction,distance,duration,fingerCount){var count=Math.round((direction==='left'?1:-1)*1.25*that.pagesize*distance/that.element.width());that._setIndex(that.options.index+count,true);}});}that.element.hover(function(){that.hovering=true;},function(){that.hovering=false;});$(window).on('keydown',function(event){if(that.hovering){switch(event.which){case 36:event.preventDefault();that._setIndex(0,true);break;case 35:event.preventDefault();that._setIndex(that._getCovers().length-1,true);break;case 38:case 37:event.preventDefault();that._setIndex(that.options.index-1,true);break;case 40:case 39:event.preventDefault();that._setIndex(that.options.index+1,true);break;case 33:event.preventDefault();that._setIndex(that.options.index-that.pagesize,true);break;case 34:event.preventDefault();that._setIndex(that.options.index+that.pagesize,true);break;}}});that._setIndex(that.options.index,false,true);that.refresh();return that;},cover:function(){return $(this._getCovers()[this.options.index]);},_getCovers:function(){return $('> *',this.element);},_setIndex:function(index,animate,initial){var covers=this._getCovers();index=Math.max(0,Math.min(index,covers.length-1));if(index!==this.options.index){this.refresh();if(animate===true){this.currentIndex=this.options.index;this.options.index=Math.round(index);var that=this,duration=typeof that.options.duration==="number"?that.options.duration:jQuery.fx.speeds[that.options.duration]||jQuery.fx.speeds._default,timeout=null,step=that.options.index>that.currentIndex?1:-1,doStep=function(){var steps=Math.abs(that.options.index-that.currentIndex),time=duration/Math.max(1,steps)*0.5;if(that.options.index!==that.currentIndex){that.currentIndex+=step;that.refresh.call(that,time,that.currentIndex);timeout=setTimeout(doStep,time);}that._callback('change');that._callback('select');};if(timeout){clearTimeout(timeout);}if(that.currentIndex!==this.options.index){doStep();}}else{this.currentIndex=this.options.index=Math.round(index);this.refresh(this.options.duration);this._callback('change');this._callback('select');}}else if(initial===true){this.refresh();this._callback('select');}},_callback:function(callback){this._trigger(callback,null,this._getCovers().get(this.currentIndex),this.currentIndex);},index:function(index){if(index===undefined){return this.options.index;}this._setIndex(index,true);},refresh:function(duration,index){var that=this,target=index||that.options.index,count=that._getCovers().length,parentWidth=that.element.innerWidth(),coverWidth=that.options.width||that._getCovers().first().outerWidth(),visible=that.options.visible==='density'?Math.round(parentWidth*that.options.density/coverWidth):$.isNumeric(that.options.visible)?that.options.visible:count,parentLeft=that.element.position().left-((1-that.options.outerScale)*coverWidth*0.5),space=(parentWidth-(that.options.outerScale*coverWidth))*0.5;duration=duration||0;that.pagesize=visible;that._getCovers().removeClass('current').each(function(index,cover){var position=index-target,offset=position/visible,isVisible=Math.abs(offset)<=1,sin=isVisible?Math.sin(offset*Math.PI*0.5):sign(offset),cos=isVisible?Math.cos(offset*Math.PI*0.5):0,isMiddle=position===0,zIndex=count-Math.abs(position),left=parentLeft+space+(isMiddle?0:sign(sin)*scl(Math.abs(sin),0,1,that.options.innerOffset*that.options.density,space)),scale=!isVisible?0:isMiddle?1:scl(Math.abs(cos),1,0,that.options.innerScale,that.options.outerScale),angle=isMiddle?0:sign(sin)*scl(Math.abs(sin),0,1,that.options.innerAngle,that.options.outerAngle),state={},css=isMiddle?that.options.selectedCss||{}:($.interpolate&&that.options.outerCss&&!$.isEmptyObject(that.options.outerCss)?(isVisible?$.interpolate(that.options.innerCss||{},that.options.outerCss,Math.abs(sin)):that.options.outerCss):{}),transform;if(isVisible){$(cover).show();}$(cover).stop().css({'z-index':zIndex}).animate($.extend(css,{'left':left,'_sin':sin,'_cos':cos,'_scale':scale,'_angle':angle}),{'easing':that.options.easing,'duration':duration,'step':function(now,fx){state[fx.prop]=now;if(fx.prop==='_angle'){transform='scale('+state._scale+','+state._scale+') perspective('+(parentWidth*0.5)+'px) rotateY('+state._angle+'deg)';$(this).css({'-webkit-transform':transform,'-ms-transform':transform,'transform':transform});that._trigger('animateStep',cover,[cover,offset,isVisible,isMiddle,state._sin,state._cos]);}},'complete':function(){$(this)[isMiddle?'addClass':'removeClass']('current');$(this)[isVisible?'show':'hide']();that._trigger('animateComplete',cover,[cover,offset,isVisible,isMiddle,sin,cos]);}});});}});}(jQuery));